<script>
    LapixFormBehavior = {
        properties: {
            values: {
                type: Object,
                observer: '_observerValues'
            },
            add: {
                type: Boolean,
                value: false
            },
            action: String,
        },
        listeners: {
            'iron-form-error': '_formError',
            'iron-form-response': '_formResponse'
        },
        _observerValues: function(params) {
            if(params){
                for (let key in params) {
                    if (params.hasOwnProperty(key)) {
                        let item = this.$.form.querySelector('[name="'+key+'"]');
                        if(item){
                            if(item.nextElementSibling && item.nextElementSibling.tagName === "PAPER-DROPDOWN-MENU"){
                                let list = item.nextElementSibling.querySelector('paper-listbox');
                                list.selected = -1;
                                list.selected = this.values[key];
                            }else{
                                item.value = this.values[key];
                            }
                        }
                    }
                }
            }else{
                this.reset();
            }
        },
        reset: function () {
            this.$.form.reset();
        },
        submit: function () {
            this.$.form.submit();
        },
        _formError: function (evn) {
            console.log(evn.detail);
            switch (evn.detail.request.status) {
                case 400:
                    let errorList = evn.detail.request.response;
                    for (let key in errorList){
                        if(errorList.hasOwnProperty(key)){
                            let item = this.$.form.querySelector('[name="'+key+'"]');
                            if(item){
                                item.errorMessage = errorList[key][0];
                                item.invalid = true;
                            }
                        }
                    }
                    break;
                case 403:
                    lapix.app.logout();
                    break;
                default:
                    break;
            }
        },
        _formResponse: function(evn){
            console.log('response', evn.detail.status);
        }
    };
</script>
