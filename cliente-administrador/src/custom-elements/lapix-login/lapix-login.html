<link rel="import" href="../../elements.html">

<dom-module id="lapix-login">
    <style include="iron-flex"></style>
    <template>
        <style>
            :host {
                display: block;
                width: 100%;
                height: 100vh;
            }
            :host .login{
                width: 450px;
                height: 350px;
            }
            :host > .full{
                width: 100%;
                height: 100%
            }
            .logo{
                width: 150px;
                height: 150px;
                margin: 0 auto;
                margin-bottom: -30px;
                background-image: url('../../../images/Icono lapix desktop vertical.svg');
            }
            paper-card{
                width: 100%;
                height: 100%;
            }
            paper-button{
                background-color: #fea000;
                color: white;
            }

            paper-button iron-icon{
                margin: 0 8px;
            }
            .margen{
                padding: 16px;
            }
            paper-input {
                --paper-input-container-focus-color: #fea000;
                --paper-input-container-label-focus: #000;
            }
            .acctions{
                padding: 8px 0;
            }
        </style>
        <div class="full layout horizontal center-center">
            <div class="login">
                <form id="loginform" is="iron-form" action$="[[action]]"  method$="[[method]]">
                    <paper-card>
                        <div class="card-content">
                            <div id="error"></div>
                            <div class="logo"></div>
                            <div id="inputs" class="margen">
                                <paper-input label="Usuario" value="{{user::input}}" name="username"></paper-input>
                                <paper-input label="Contraseñsa" value="{{pass::input}}" name="password" type="password"></paper-input>
                            </div>
                        </div>
                        <div class="card-actions">
                            <div class="layout horizontal center-justified acctions margen">
                                <paper-button id="btnforgot" raised >Recuperar Contraseña<iron-icon icon="report"></iron-icon></paper-button>
                                <paper-button id="btnlogin" raised >Acceder <iron-icon icon="send"></iron-icon></paper-button>
                            </div>
                        </div>
                    </paper-card>
                </form>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: "lapix-login",
            properties: {
                action: {
                    type: String,
                    notify: true
                },
                method: {
                    type: String,
                    notify: true
                },
                newUrl: {
                    type: String,
                    notify: true
                }
            },
            listeners: {
                'btnlogin.tap': '_loginSubmit',
                'btnforgot.tap': '_loginForgot',
                'loginform.iron-form-response': '_onResponse',
                'loginform.iron-form-error': '_onError',
                'loginform.iron-form-presubmit': '_preSend'
            },
            _loginSubmit: function(){
                this.$.loginform.submit();
            },
            _loginForgot: function () {
                console.log('forgot');
            },
            _onResponse: function (data) {
                if(window.ipc && this.newUrl){
                    window.ipc.send('go-to', { file: this.newUrl});
                }else{
                    console.log('ipc o newUrl indefinido');
                }
            },
            _onError: function (e) {
                console.log(e.detail);
                switch (e.detail.request.status) {
                    case 400:
                        let errorList = e.detail.request.response;
                        for (let key in errorList){
                            if(errorList.hasOwnProperty(key)){
                                let item = this.$.inputs.querySelector('[name="'+key+'"]');
                                console.log(key, item);
                                if(item){
                                    item.errorMessage = errorList[key][0];
                                    item.invalid = true;
                                }else if(key === "error"){
                                    this.$.error.textContent = errorList[key][0]
                                }
                            }
                        }
                        break;
                    default:
                        break;
                }
            },
            _preSend: function () {
                this.$.error.textContent = ""
            }
        });
    </script>
</dom-module>
