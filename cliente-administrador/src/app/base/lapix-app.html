<link rel="import" href="../../elements.html">

<dom-module id="lapix-app">

    <template>
        <style include="lapix-style"></style>
        <style>

            :host {
                display: block;
                --accent-color: var(--lapix-accent, --accent-color);
            }
            app-header {
                background-color: var(--app-primary-color);
                color: #fff;
            }
            paper-toolbar{
                --paper-toolbar-background: var(--lapix-header);
                --paper-toolbar-color: var(--lapix-text);
            }
            app-drawer{
                --app-drawer-content-container: {
                    background-color: var(--lapix-accent-back);
                }
            }
            app-drawer paper-toolbar{
                --paper-toolbar-background: var(--lapix-text);
            }

            app-drawer .drawer-list paper-submenu paper-menu{
                --paper-menu-background-color: var(--lapix-accent-back);
            }
            app-drawer .drawer-list paper-submenu paper-menu paper-item {
                --paper-item: {
                    padding-left: 90px;
                };
            }
            .drawer-list {
                margin: 0;
                color: var(--lapix-text);
                --paper-menu-background-color: var(--lapix-accent-back);
            }
            .drawer-list  paper-icon-item{
                cursor: pointer;
                --paper-item-selected: {
                    color: var(--lapix-accent-light);
                };
            }
            #logo{
                cursor: pointer;
                margin-top: 62px;
                width: 200px;
            }

        </style>

        <app-drawer-layout id="dr" fullbleed>
            <!-- Drawer content -->
            <app-drawer >
                <paper-toolbar class="medium-tall">
                    <img id="logo" src="../../images/logo_lapix_desktop_horizontal.svg" alt="Logo">
                </paper-toolbar>
                <paper-menu id="menu" selected="{{page}}" attr-for-selected="name" class="drawer-list" role="navigation">
                    <paper-icon-item name="home">
                        <iron-icon icon="extension" item-icon></iron-icon>Dashboard
                    </paper-icon-item>
                    <paper-submenu>
                        <paper-icon-item class="menu-trigger" >
                            <iron-icon icon="settings" item-icon></iron-icon>Registros
                        </paper-icon-item>
                        <paper-menu class="menu-content" selected="{{page}}" attr-for-selected="name">
                            <paper-item name="registro-profesores">Profesores</paper-item>
                            <paper-item name="registro-estudiantes">Estudiantes</paper-item>
                            <paper-item name="registro-acudientes">Acudientes</paper-item>
                        </paper-menu>
                    </paper-submenu>
                    <paper-icon-item name="view1">
                        <iron-icon icon="extension" item-icon></iron-icon>view1
                    </paper-icon-item>
                    <paper-icon-item name="view2">
                        <iron-icon icon="settings" item-icon></iron-icon>view2
                    </paper-icon-item>
                </paper-menu>
            </app-drawer>
            <!-- Main content -->
            <app-header-layout has-scrolling-region>
                <paper-toolbar>
                    <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
                    <div class="title">Lapix</div>
                    <paper-icon-button icon="cached" on-tap="_winReload"></paper-icon-button>
                    <paper-menu-button horizontal-align="right">
                        <paper-icon-button icon="more-vert" class="dropdown-trigger"></paper-icon-button>
                        <paper-menu class="dropdown-content">
                            <paper-icon-item on-tap="_openDevTools"><iron-icon icon="bug-report" item-icon></iron-icon>DevTools</paper-icon-item>
                            <paper-icon-item on-tap="_logout"><iron-icon icon="power-settings-new" item-icon></iron-icon>Logout</paper-icon-item>
                        </paper-menu>
                    </paper-menu-button>
                </paper-toolbar>
                <iron-pages id="pages" role="main" selected="[[page]]" attr-for-selected="name">
                    <lapix-home   name="home" bar="[[drawer]]"></lapix-home>
                    <lapix-view1  name="view1" bar="[[drawer]]"></lapix-view1>
                    <lapix-view2  name="view2" bar="[[drawer]]"></lapix-view2>
                    <lapix-registro-profesores  name="registro-profesores" bar="[[drawer]]"></lapix-registro-profesores>
                    <lapix-registro-estudiantes  name="registro-estudiantes" bar="[[drawer]]"></lapix-registro-estudiantes>
                    <lapix-registro-acudientes name="registro-acudientes" bar="[[drawer]]"></lapix-registro-acudientes>
                </iron-pages>
                <div id="toast_container">
                    <paper-toast id="toast"></paper-toast>
                </div>
            </app-header-layout>
        </app-drawer-layout>
        <iron-ajax id="logout" handle-as="json" on-response="_logoutResponse"></iron-ajax>
        <iron-ajax id=""
          auto
          url=""
          handle-as="json"
          on-response="handleResponse"></iron-ajax>
    </template>

    <script>
        Polymer({

            is: 'lapix-app',

            behaviors: [LapixBehavior],

            properties: {
                page: {
                    type: String,
                    notify: true,
                    value: 'home',
                    reflectToAttribute: true,
                    observer: '_pageChanged'
                }
            },

            listeners: {
                'logo.tap': '_onGoToHome'
            },

            ready: function() {
                window.lapix = window.lapix || {};
                window.lapix.app = this;
                this.$.logout.url = lapix.conf.get('host') + 'usuarios/logout/';
                this.$.toast.fitInto = this.$.toast_container;
            },

            _pageChanged: function(page, oldPage) {
                if(page){
                    this.importHref(this.resolveUrl('../sections/lapix-' + page + '.html'), null, null, true);
                }else{
                    this.page = oldPage;
                }
            },

            _onGoToHome: function () {
                this.page = 'home';
            },
            _openToast: function (m, d) {
                window.t = this.$.toast;
                this.$.toast.text = m || " ";
                this.$.toast.duration = d || 3;
                console.log('toast', this.$.toast.text, this.$.toast.duration);
                this.$.toast.opened = true;
            },
            logout: function(){
                this.$.logout.generateRequest();
            },
            _logoutResponse: function(evn){
                ipc.send('go-to', {
                    file: 'login.html'
                });
            }
        });
    </script>

</dom-module>
